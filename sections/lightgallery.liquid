{% comment %}
  Section : lightgallery (masonry 3 colonnes centrées)
{% endcomment %}

{% if section.blocks.size > 0 %}
  <div class="lightgallery-wrapper">
    <div id="lightgallery-{{ section.id }}" class="lg-masonry">
      {% for block in section.blocks %}
        <a href="{{ block.settings.image | image_url: width: 1600 }}" data-sub-html="">
          <img
            src="{{ block.settings.image | image_url: width: 600 }}"
            alt="{{ block.settings.image.alt | escape }}"
            loading="lazy"
          >
        </a>
      {% endfor %}
    </div>
  </div>

  <style>
    /* --- Conteneur centré --- */
    .lightgallery-wrapper {
      margin-top: 16px;
      max-width: 750px;
      margin-left: auto;
      margin-right: auto;
      padding: 0 16px;
    }

    /* --- Masonry : 3 colonnes --- */
    #lightgallery-{{ section.id }}.lg-masonry {
      column-count: 3;       /* nombre de colonnes */
      column-gap: 16px;      /* espace entre colonnes */
    }

    /* Responsive */
    @media (max-width: 1024px) {
      #lightgallery-{{ section.id }}.lg-masonry {
        column-count: 2;
      }
    }
    @media (max-width: 640px) {
      #lightgallery-{{ section.id }}.lg-masonry {
        column-count: 1;
      }
    }

    /* Empêche les liens de se casser sur plusieurs colonnes */
    #lightgallery-{{ section.id }} a {
      display: inline-block;
      margin-bottom: 8px; /* espace entre images */
      width: 100%;
    }

    /* Miniatures responsives */
    #lightgallery-{{ section.id }} img {
      display: block;
      width: 100%;
      height: auto;
    }

    /* --- Lightbox centrée --- */
    .lg-inner {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .lg-object {
      max-width: 100%;
      max-height: 100%;
      margin: auto;
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const galleryEl = document.getElementById('lightgallery-{{ section.id }}');
      if (galleryEl && window.lightGallery) {
        lightGallery(galleryEl, {
          selector: 'a',
          plugins: typeof lgZoom !== 'undefined' && typeof lgThumbnail !== 'undefined' ? [lgZoom, lgThumbnail] : [],
          speed: 400,
          download: false,
          getCaptionFromTitleOrAlt: false,
          mobileSettings: {
            controls: true,
            showCloseIcon: true,
            download: false,
            rotate: false,
          },
        });
      }
    });
  </script>
{% else %}
  <p>Aucune image n'a été ajoutée à la galerie.</p>
{% endif %}

{% schema %}
{
  "name": "Galerie LightGallery",
  "settings": [
    {
      "type": "header",
      "content": "Ajoutez des images à votre galerie"
    }
  ],
  "blocks": [
    {
      "type": "image_block",
      "name": "Image",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        }
      ]
    }
  ],
  "max_blocks": 50,
  "presets": [
    {
      "name": "Galerie LightGallery (masonry 3 colonnes)",
      "blocks": []
    }
  ]
}
{% endschema %}
